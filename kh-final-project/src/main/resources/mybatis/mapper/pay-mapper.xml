<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pay">

	<!-- 시퀀스 생성 -->
	<select id="sequence" resultType="int">
		select pay_seq.nextval from
		dual
	</select>

	<!-- pay 테이블 값 등록 -->
	<insert id="ready" parameterType="PayDto">
		insert into pay values(
		#{payNo},
		#{payTid},
		#{payPrice},
		'결제 요청',
		systimestamp,
		#{memberNo},
		0
		)
	</insert>

	<!-- 번호 조회 -->
	<select id="get" resultType="PayDto" parameterType="int">
		select * from
		pay where pay_no = #{payNo}
	</select>

	<!-- 승인 데이터 등록 -->
	<update id="approve" parameterType="int">
		update pay
		set pay_status='결제
		완료'
		where pay_no = #{payNo}
	</update>

	<!-- 기존포인트와 입력한 포인트 더하기 -->
	<update id="plus" parameterType="int">
		UPDATE MEMBER
		SET member_have_point =
		member_have_point + #{pay_price}
	</update>

	<!-- <update id = "plusResult"> UPDATE member SET member_have_point =( SELECT 
		pay_all_price FROM pay WHERE pay.pay_no = pay.pay_no ) </update> -->

	<!-- 취소 데이터 등록 -->
	<update id="cancel" parameterType="int">
		update pay
		set pay_status='취소'
		where pay_no = #{paymentNo}
	</update>

	<!-- 조회 1. 회원 1명의 전체 결제내역 조회 2. 결제내역 1개에 대한 단일조회 -->
	<!-- <select id="list" resultType="PaymentDto" parameterType="int"> select 
		* from payment where payment_buyer = #{paymentBuyer} order by payment_no 
		desc <<<<<<< HEAD </select> ======= </select> -->

</mapper>